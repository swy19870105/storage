## SAN网络迁移指南——Brocade篇

原创 *2016-07-26* *EMC中文技术社区* [EMC易安信中国技术社区](https://mp.weixin.qq.com/s?__biz=MjM5NjY0NzAwMg==&mid=2651771229&idx=2&sn=7aa9105793672d50258372921fbb77d5&scene=21##)

​      如今的SAN网络管理员面对是不断增长的存储和吞吐量需求。这需要既可以满足当前需求，也可以应对未来增长的高性能和全冗余的SAN网络。为了适应这些变化，SAN管理员们不得不经常考虑迁移或升级现有的存储网络。

​      上一次我们介绍了SAN网络迁移前的准备工作，这回我们将介绍将SAN网络迁移至Brocade光纤交换机的步骤。

[SAN网络迁移指南——迁移前准备工作](http://mp.weixin.qq.com/s?__biz=MjM5NjY0NzAwMg==&mid=2651771224&idx=3&sn=7574f27b5500753edd9d372a2f268400&scene=21#wechat_redirect)

 

**迁移前评估:**

 

​      在正式迁移光纤网络前，了解当前应用环境和新网络需求是非常重要的。取决于现有SAN网络的架构、光纤网络拓扑、大小和活动设备的数量，具体的迁移过程有不止一种方法。取决于应用和项目的需要，SAN网络还可以在线或离线的方式来完成迁移。因此，不管是哪一种迁移方法，下面这些因素是需要考虑的：

- 评估当前的光纤网络拓扑

- - 应用故障转移需求
  - 存储故障转移需求
  - 是否需要同时升级现有拓扑（去除SAN网络中性能瓶颈、服务器/存储扩容、布线管理等常规光纤网络维护）
  - Zone配置导出方法
  - 服务器、存储物理摆放位置优化

- 评估新光纤网络拓扑

- - Brocade Fabric OS升级要求
  - 捕获现有交换机配置并与Brocade交换机配置比较
  - 导入Zone配置方法
  - 中继（Trucking）设置
  - 未来服务器、存储物理扩展规划

- 硬件安装逻辑规划

- - 机架空间需求
  - 电源需求
  - 布线需求

- 拓扑和Zone配置规划

- 初步的迁移计划

[![img](http://mmbiz.qpic.cn/mmbiz/TztEwAzAQIVrHiaZvt93tBDfUsSEgLf2Xm7gwnHvWRDc2RC19k9lQ5WTH7ick8ukEbw1icJY0Xz2HE9nT5Vd95kAw/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1)]()

 

**迁移策略：**

 

​      在评估完所有需求后，迁移步骤主要分为下面两大类：

- 在线迁移（冗余的光纤网络）

- - 冗余的光纤网络使得在升级或迁移部分设备时，将活动I/O重定向到另一个光纤网络成为可能。整个迁移活动不影响当前的I/O操作。使用这种策略，主机在降级模式下工作且没有多余的数据路径提供故障保护。通过适当的规划，可以最小化停机或中断时间。一旦完成网络的升级并验证，通过复原数据路径，可以迅速重新上线

- 离线迁移

- - 光纤网络还可以离线迁移，在维护时间内，停止主机使得前端I/O完全停止。这是最安全且最方便的迁移方法，当然前提是应用允许停机。

 

**迁移计划和准备：**

 

​      一个良好的迁移计划包含下面这些步骤：

- 项目范围和成功条件
- 阶段、任务和子任务
- 资源定义
- 时间线安排
- 任务依赖性
- 跟踪和检查点
- 流程、设计和配置的移交
- 回滚计划和中止条件

具体到迁移，可以从下面几个方面来检查：   

​                                 

| 迁移步骤                                    | 结果   | 注释                                       |
| --------------------------------------- | ---- | ---------------------------------------- |
| 机柜、机架、线缆和电力部署                           |      |                                          |
| 安装Brocade Network   Advisor             |      |                                          |
| 安装Brocade SAN Health并搜索Brocade和旧有光纤网络设备 |      | 使用SAN评估和Zone导入工具                         |
| 安装配置Brocade交换机的管理口和串口                   |      |                                          |
| 安装推荐的Brocade FOS                        |      |                                          |
| 创建所有交换机的基准配置                            |      |                                          |
| 导入Zoning设置                              |      | 使用Brocade SAN Health                     |
| 安装授权许可文件                                |      |                                          |
| 删除不再使用的Zoneset                          |      |                                          |
| 为新设备创建Zone                              |      | Brocade   HBA可以使用Dynamic Fabric Provisioning功能 |
| 验证ISL配置                                 |      | Spinfab和D-port（16Gbps平台）                 |

 

 

**迁移和验证：**

 

​      迁移完成后，很重要的一步是迁移后的验证。下面这些步骤可以确保哦哦所有的任务正确完成：

- 运行Brocade SAN Health工具
- 确认新的SAN网络配置
- 确认应用工作状态
- 完成SAN迁移收尾工作
- 撤除旧有设备